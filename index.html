<html>

<head>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script> (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-1110814073017760",
            enable_page_level_ads: true
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/locale/es-us.js"></script>
    <title>How Old Are My Kids?</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">


</head>

<body class="bg-light" onload="onLoad()">
    <div class="jumbotron">

        <div class="container">
            <h1 class="display-4 text-center">How old are my kids?!</h1>

            <hr class="mb-4">
            <div class="container col-10" id="existingNames"></div>

        </div>
    </div>
    <div class="container">

        <h4 class="mb-3">Add Name</h4>
        <form id="addName" class="needs-validation" novalidate>
            <div class="row align-items-center">
                <div class="col-3 mb-4">
                    <label for="firstName">Name</label>
                    <input type="text" class="form-control" id="name" placeholder="" value="" required>
                    <div class="invalid-feedback">
                        Valid name is required.
                    </div>
                </div>

                <div class="col-4 mb-4">
                    <label for="birthday">Birthday</label>
                    <input type="date" class="form-control" id="birthday" placeholder="" value="" required>
                    <div class="invalid-feedback">
                        Valid birthday is required.
                    </div>
                </div>
                <div class="col-3">
                    <button class="btn btn-primary btn-lg btn-block" onclick="return addName();">Add Name</button>

                </div>
            </div>

            <hr class="mb-4">
        </form>

    </div>
    <br/>
    <br/>
    <div class="container">
        <p>I built HowOldAreMyKids.com to be a service that helps forgetful parents (dads) remember how old their children are
            TODAY. Being a parent of four, this can be challenging at times. When someone asks me how old my kids are, I
            have to do arithmetic gymnastics to figure it out.
        </p>
        <p>Use this site by entering your kids' names and birthdays. Then, store a bookmark to the page. No information is stored
            on our servers. When someone asks how old your children are, pull up your bookmarked page.</p>
    </div>

    <script>
        function calculateAge(birthday) { // birthday is a date
            console.log(birthday);
            var ageDifMs = Date.now() - birthday;
            var ageDate = new Date(ageDifMs); // miliseconds from epoch
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        }

        function parseNames() {
            var url_string = window.location.href;
            var url = new URL(url_string);

            var params = [];
            for (let p of url.searchParams) {
                var values = [];
                values.push(p[0]);
                values.push(calculateAge(Date.parse(p[1])));
                values.push(p[1]);
                params.push(values)
            }

            params.sort(function (a, b) { return b[1] - a[1]; });

            return params
        }

        function createTable(rows) {
            var table = document.createElement('div');
            table.classList.add('container');

            var tableHeader = document.createElement('div');
            tableHeader.classList.add("row");
            var headerCell = document.createElement('div');
            headerCell.classList.add("col-3");
            headerCell.classList.add("h5");
            headerCell.classList.add("text-left");
            headerCell.appendChild(document.createTextNode("Name"));
            tableHeader.appendChild(headerCell);

            var headerCell = document.createElement('div');
            headerCell.classList.add("col-1");
            headerCell.classList.add("h5");
            headerCell.classList.add("text-right");
            headerCell.appendChild(document.createTextNode("Age"));
            tableHeader.appendChild(headerCell);

            var headerCell = document.createElement('div');
            headerCell.classList.add("col");
            headerCell.classList.add("h5");
            headerCell.classList.add("text-right");
            headerCell.appendChild(document.createTextNode("Birthday"));
            tableHeader.appendChild(headerCell);

            var headerCell = document.createElement('div');
            headerCell.classList.add("col");
            headerCell.classList.add("h5");
            headerCell.appendChild(document.createTextNode(""));
            tableHeader.appendChild(headerCell);

            table.appendChild(tableHeader);

            var i = 0;

            for (let p of rows) {
                console.log(p);

                var row = document.createElement('div');
                row.classList.add("row");
                row.classList.add("mb-3");
                row.classList.add("align-items-center");

                var cell = document.createElement('div');
                cell.classList.add("col-3");
                cell.classList.add("text-left");
                cell.appendChild(document.createTextNode(p[0]));
                row.appendChild(cell);

                var cell = document.createElement('div');
                cell.classList.add("col-1");
                cell.classList.add("text-right");
                cell.appendChild(document.createTextNode(p[1]));
                row.appendChild(cell);

                var cell = document.createElement('div');
                cell.classList.add("col");
                cell.classList.add("text-right");
                var d = moment(p[2], "YYYY-MM-DD");

                cell.appendChild(document.createTextNode(d.format("l")));
                row.appendChild(cell);

                var cell = document.createElement('div');
                cell.classList.add("col");
                cell.classList.add("text-right");
                var button = document.createElement("button");
                button.appendChild(document.createTextNode("remove"));
                button.onclick = function () { remove(this); };
                button.value = i;
                cell.appendChild(button);
                row.appendChild(cell);

                table.appendChild(row);
                i++;
            }

            document.getElementById("existingNames").appendChild(table);
        }

        function onLoad() {
            var names = parseNames();
            createTable(names);
        }

        function addName() {
            console.log(document.getElementById("addName").classList);
            console.log(document.getElementById("name").value);
            console.log(document.getElementById("birthday").value);

            var form = document.getElementById("addName");
            var isValid = true;

            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
                isValid = false;
            }

            form.classList.add('was-validated');

            if (!isValid) {
                console.log("NOT VALID");
                return false;
            }

            var names = parseNames();

            var newName = [];
            newName.push(document.getElementById("name").value);
            newName.push(0);
            newName.push(document.getElementById("birthday").value);

            names.push(newName);

            window.location.href = generateUri(names);

            return false;
        }

        function getCleanUri() {
            var uri = window.location.href;

            console.log(uri);

            if (uri.indexOf("?") > 0) {
                var clean_uri = uri.substring(0, uri.indexOf("?"));
                return clean_uri;
            }

            return uri;
        }

        function generateUri(names) {
            var uri = getCleanUri();

            var qs = "";
            if (names.length > 0) {
                for (let n of names) {
                    if (qs !== "") qs += "&";

                    qs += n[0] + "=" + n[2];
                }

                uri += "?" + qs;
            }
            console.log(uri);
            return uri;
        }

        function remove(i) {
            var names = parseNames();

            names.splice(i.value, 1);

            window.location.href = generateUri(names);
        }

    </script>

</body>

</html>